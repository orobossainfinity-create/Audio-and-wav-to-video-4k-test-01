<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultra Light Image + Audio → Video POC</title>
<style>
  body { margin:0; background:#000; color:#fff; font-family:Arial; text-align:center; padding:20px; }
  canvas, video { max-width:100%; height:auto; display:block; margin:20px auto; }
  button { padding:12px 30px; font-size:18px; background:#444; color:white; border:none; border-radius:8px; cursor:pointer; }
</style>
</head>
<body>

<h2>Proof of Concept: Image + Audio → MP4 (native browser only)</h2>
<p>Very lightweight – no heavy libraries. Works on most phones. Video = static image + audio track.</p>

<input type="file" id="imageInput" accept="image/*"><br><br>
<input type="file" id="audioInput" accept="audio/*"><br><br>

<button onclick="makeVideo()">Create Video</button>

<canvas id="canvas" width="640" height="360" style="display:none"></canvas>
<video id="preview" controls style="max-width:90%"></video>

<script>
// Global vars
let imageURL = null;
let audioURL = null;

document.getElementById('imageInput').onchange = e => {
  const file = e.target.files[0];
  if (file) imageURL = URL.createObjectURL(file);
};

document.getElementById('audioInput').onchange = e => {
  const file = e.target.files[0];
  if (file) audioURL = URL.createObjectURL(file);
};

async function makeVideo() {
  const status = document.createElement('p');
  document.body.appendChild(status);
  status.textContent = "Creating...";

  if (!imageURL || !audioURL) {
    status.textContent = "Select both image and audio first!";
    return;
  }

  // 1. Draw image on canvas
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = imageURL;

  await new Promise(r => img.onload = r);

  // Scale to fit canvas
  const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
  const w = img.width * scale;
  const h = img.height * scale;
  ctx.drawImage(img, (canvas.width - w)/2, (canvas.height - h)/2, w, h);

  // 2. Create stream from canvas (static image = single frame loop)
  const stream = canvas.captureStream(1); // 1 fps = static

  // 3. Get audio track
  const audio = new Audio(audioURL);
  await new Promise(r => audio.onloadedmetadata = r);

  // 4. Merge audio into video stream using MediaRecorder
  const recorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9,opus' });

  const chunks = [];
  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.onstop = () => {
    const blob = new Blob(chunks, { type: 'video/webm' });
    const url = URL.createObjectURL(blob);
    const video = document.getElementById('preview');
    video.src = url;
    video.controls = true;
    status.textContent = "Done! Video ready (WebM format – you can convert later if needed)";
  };

  // Start recording
  recorder.start();
  audio.play();

  // Record for audio duration + a bit extra
  setTimeout(() => {
    recorder.stop();
    audio.pause();
  }, (audio.duration * 1000) + 1000);
}
</script>
</body>
  </html>
