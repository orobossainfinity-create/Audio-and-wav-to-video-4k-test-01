<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luxury Image + WAV to 4K Video Converter â€“ Netlify Edition</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Great+Vibes&display=swap');

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      background:#000;
      color:#ffd700;
      font-family:'Cinzel Decorative', cursive;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      overflow-x:hidden;
      position:relative;
    }

    /* Starry night with shining diamonds */
    .particles {
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:1;
      background: radial-gradient(circle at top, #000033, #000000 60%);
    }

    .particle {
      position:absolute;
      background:linear-gradient(135deg,#ffd700,#ffea00,#ffd700,#fff,#ffd700);
      border-radius:50%;
      box-shadow:0 0 10px #ffea00, 0 0 20px #ffd700, 0 0 30px rgba(255,215,0,0.3);
      opacity:0;
      animation:twinkle 5s infinite ease-in-out, drift 30s infinite linear;
    }

    @keyframes twinkle {
      0%,100% { opacity:0; transform:scale(0.6) rotate(0deg); }
      50% { opacity:1; transform:scale(1.1) rotate(180deg); }
    }

    @keyframes drift {
      0% { transform:translate(0,100vh); }
      100% { transform:translate(0,-20vh); }
    }

    .container {
      position:relative;
      z-index:10;
      background:rgba(0,0,0,0.7);
      backdrop-filter:blur(15px);
      border:2px solid #d4af37;
      border-radius:30px;
      padding:50px;
      max-width:750px;
      text-align:center;
      box-shadow:0 0 60px rgba(255,215,0,0.6);
    }

    h1 {
      font-family:'Great Vibes', cursive;
      font-size:4.2rem;
      margin-bottom:25px;
      text-shadow:0 0 30px #ffd700;
    }

    p { font-size:1.3rem; margin-bottom:30px; opacity:0.95; }

    .file-label {
      display:block;
      font-size:1.4rem;
      margin:25px 0 10px;
      text-align:left;
      font-weight:bold;
    }

    input[type="file"] {
      width:100%;
      padding:14px;
      background:rgba(255,215,0,0.1);
      color:#ffd700;
      border:1px solid #d4af37;
      border-radius:15px;
      font-size:1.2rem;
      cursor:pointer;
    }

    button {
      background:linear-gradient(135deg,#d4af37,#b8860b);
      color:#000;
      border:none;
      padding:18px 60px;
      font-size:1.5rem;
      font-weight:bold;
      border-radius:60px;
      cursor:pointer;
      margin:35px 0 25px;
      box-shadow:0 0 30px #ffd700;
      transition:all 0.3s;
    }

    button:hover { transform:scale(1.12); box-shadow:0 0 50px #ffea00; }

    #status { margin:35px 0; font-size:1.6rem; min-height:2.5em; }

    .progress-container {
      width:100%;
      background:#111;
      border-radius:60px;
      height:32px;
      margin:30px 0;
      overflow:hidden;
      border:2px solid #d4af37;
      display:none;
      box-shadow:0 0 25px rgba(212,175,55,0.5);
    }

    .progress-bar {
      width:0%;
      height:100%;
      background:linear-gradient(90deg,#ffd700,#ffea00,#ffd700);
      border-radius:60px;
      transition:width 0.6s ease;
      box-shadow:0 0 30px #ffea00 inset;
      position:relative;
    }

    .progress-bar::after {
      content:'';
      position:absolute;
      inset:0 0 0 -100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.6),transparent);
      animation:shineBar 2s infinite linear;
    }

    @keyframes shineBar { 0%{transform:translateX(-100%);} 100%{transform:translateX(300%);} }

    #download {
      display:none;
      margin-top:40px;
      padding:18px 60px;
      background:linear-gradient(135deg,#d4af37,#b8860b);
      color:#000;
      text-decoration:none;
      border-radius:60px;
      font-size:1.5rem;
      font-weight:bold;
      box-shadow:0 0 30px #ffd700;
    }

    #download:hover { transform:scale(1.1); }
  </style>
</head>
<body>

  <div class="particles" id="particles"></div>

  <div class="container">
    <h1>Luxury 4K Converter</h1>
    <p>Transform your image & high-quality WAV (up to 100MB) into supreme 4K video</p>

    <label class="file-label">Select Image (any format, will upscale to 4K)</label>
    <input type="file" id="image" accept="image/*">

    <label class="file-label">Select Audio (WAV file, up to 100MB)</label>
    <input type="file" id="audio" accept=".wav">

    <button onclick="convert()">Begin Enchantment</button>

    <div id="status"></div>

    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <a id="download">Download Your Masterpiece</a>

    <p style="font-size:1.1rem; margin-top:35px; opacity:0.8;">
      Note: Powered by multi-threaded FFmpeg on Netlify for faster processing of large files.
    </p>
  </div>

  <script type="module">
    import { FFmpeg } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/esm/ffmpeg.js';
    import { fetchFile, toBlobURL } from 'https://unpkg.com/@ffmpeg/util@0.12.1/dist/esm/index.js';

    const status = document.getElementById('status');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const downloadLink = document.getElementById('download');
    const particlesContainer = document.getElementById('particles');

    // Create starry night diamonds shining at different times
    function createParticles() {
      for (let i = 0; i < 150; i++) {  // More particles for starry effect
        const particle = document.createElement('div');
        particle.className = 'particle';
        const size = Math.random() * 5 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = particle.style.width;
        particle.style.left = `${Math.random() * 100}vw`;
        particle.style.top = `${Math.random() * 120}vh`;
        particle.style.animationDelay = `${Math.random() * 10}s`;  // Different start times
        particle.style.animationDuration = `${4 + Math.random() * 6}s`;  // Varied twinkle speeds
        const hueShift = Math.random() * 30 - 15;  // Slight color variation for stars
        particle.style.filter = `hue-rotate(${hueShift}deg)`;
        particlesContainer.appendChild(particle);
      }
    }
    createParticles();

    async function convert() {
      status.textContent = 'Awakening the cosmic forces...';
      progressContainer.style.display = 'block';
      progressBar.style.width = '2%';

      const ffmpeg = new FFmpeg({ log: true });

      try {
        const baseURL = 'https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/umd';  // Multi-threaded for Netlify
        await ffmpeg.load({
          coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, 'text/javascript'),
          wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, 'application/wasm'),
          workerURL: await toBlobURL(`${baseURL}/ffmpeg-worker.js`, 'application/javascript')
        });

        progressBar.style.width = '15%';
        status.textContent = 'Gathering your celestial elements...';

        const imageFile = document.getElementById('image').files[0];
        const audioFile = document.getElementById('audio').files[0];
        if (!imageFile) throw new Error('No image selected.');
        if (!audioFile) throw new Error('No WAV audio selected.');

        await ffmpeg.writeFile('input.jpg', await fetchFile(imageFile));
        await ffmpeg.writeFile('input.wav', await fetchFile(audioFile));

        progressBar.style.width = '25%';
        status.textContent = 'Weaving 4K magic with supreme encoding... (may take minutes for large files)';

        const progressInterval = setInterval(() => {
          let current = parseFloat(progressBar.style.width);
          if (current < 90) {
            progressBar.style.width = `${Math.min(90, current + Math.random() * 8 + 2)}%`;
          }
        }, 4000);

        await ffmpeg.exec([
          '-loop', '1',
          '-i', 'input.jpg',
          '-i', 'input.wav',
          '-c:v', 'libx264',
          '-crf', '0',
          '-preset', 'veryslow',
          '-tune', 'stillimage',
          '-vf', 'scale=3840:2160:force_original_aspect_ratio=decrease:flags=lanczos,pad=3840:2160:(ow-iw)/2:(oh-ih)/2,format=yuv420p',
          '-c:a', 'aac',
          '-b:a', '320k',
          '-shortest',
          '-y',
          'output.mp4'
        ]);

        clearInterval(progressInterval);
        progressBar.style.width = '100%';
        status.textContent = 'Your starry masterpiece is born!';
        await new Promise(r => setTimeout(r, 1200));

        const data = await ffmpeg.readFile('output.mp4');
        const blob = new Blob([data.buffer], { type: 'video/mp4' });
        const url = URL.createObjectURL(blob);

        downloadLink.href = url;
        downloadLink.download = 'luxury_4k_starry_video.mp4';
        downloadLink.style.display = 'inline-block';
        downloadLink.click();

      } catch (err) {
        clearInterval(progressInterval);
        console.error(err);
        status.textContent = 'Cosmic disruption: ' + (err.message || 'Unknown anomaly');
        progressBar.style.background = 'linear-gradient(90deg,#8b0000,#ff4040)';
      }
    }

    window.convert = convert;
  </script>
</body>
</html>
